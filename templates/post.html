{% extends "layout.html" %}

{% block title %}{{ post.title }}{% endblock %}
{% block og_description %}{{ post.meta_description }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block og_image %}{{ post.thumbnail }}{% endblock %}
{% block meta_description %}{{ post.meta_description }}{% endblock %}
{% block meta_robots %}index,follow{% endblock %}

{% block head_extra %}
<meta name="date" content="{{ post.seo_date }}">
<meta property="article:published_time" content="{{ post.seo_date }}">
<meta property="article:author" content="{{ post.creator }}">
<meta property="article:modified_time" content="{{ post.updated }}">
{% endblock %}

{% block content %}
  <article
  id="post"
  data-post="1"
  data-post-id="{{ post.id }}"
  data-post-slug="{{ post.slug }}"
>
  <h1>{{ post.title }}</h1>

  <div class="post-content-meta">
    <p>
      <a href="/kategorie/{{ post.category }}">{{ post.category }}</a>
      | {{ post.created }}
      | {{ post.creator }}
      | üëÅ {{ post.views or 0 }} wy≈õwietle≈Ñ 
        {% if post.comments_on %}
            | {{ post.comments or 0 }} komentarzy
        {% endif %}
      | {{ post.reading_time }} minut(y) czytania
      | <a href="#" class="share-link" data-modal="share-modal-{{ post.id }}">Udostƒôpnij</a>
    </p>
  </div>

  {% if post.thumbnail %}
    <img class="post-inside-thumbnail"
         src="{{ post.thumbnail }}"
         alt="Thumbnail {{ post.title }}"
         loading="eager"
         decoding="async">
  {% endif %}

  {% if post.toc and post.toc|length > 0 %}
<nav class="toc" aria-label="Spis tre≈õci">
  <h3>Spis tre≈õci</h3>
  <ol>
    {% for item in post.toc %}
      <li class="toc-item toc-h{{ item.level }}">
        <a class="toc-link" href="#{{ item.id }}" title="{{ item.title }}">{{ item.title | truncate(30) }}</a>
      </li>
    {% endfor %}
  </ol>
</nav>
{% endif %}


  <div class="post-content">
    {{ lazy_images(post.content) | safe }}
  </div>

{% if post.sources %}
  <div class="post-sources">
    <p>≈πr√≥d≈Ça:</p>

    <ol>
      {% for s in post.sources %}
        {% if s is string %}
          <li>{{ s }}</li>
        {% else %}
          <li>
            {% if s.url %}
              <a href="{{ s.url }}" target="_blank" rel="noopener nofollow">{{ s.title or s.url }}</a>
            {% else %}
              {{ s.title or s }}
            {% endif %}
          </li>
        {% endif %}
      {% endfor %}
    </ol>
  </div>
{% endif %}

    <div class="reactions" data-post-id="{{ post.id }}" data-active="{{ active_reaction or '' }}">
    <a class="btn share-link" href="#" data-modal="share-modal-{{ post.id }}">Udostƒôpnij</a>
  </div>

<section class="related-posts">
  <h3>Przeczytaj jeszcze:</h3>

  {% if post.related_posts %}
    <div class="related-grid">
      {% for p in post.related_posts %}
        <a class="related-card" href="/post/{{ p.slug }}">
          <div class="related-card__title">{{ p.title }}</div>
          {% if p.category %}
            <div class="related-card__meta">{{ p.category }}</div>
          {% endif %}
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p>Brak propozycji.</p>
  {% endif %}
</section>

  <hr class="hr-default"><br>

  {% if post.comments_on %}
    <div id="comments" class="comments-container">
      <div class="comments-section">
        <h3>Komentarze: ({{ comments_total_items if comments_total_items is not none else (post.comments_total or 0) }})</h3>

{% set approved_comments = comments | selectattr('approved') | list if comments else [] %}

{% if approved_comments %}
    <ul class="comments-list">
    {% for comment in approved_comments %}
        <li>
            <p><strong>{{ comment.author }}</strong>
                {% if comment.email %}(<a href="mailto:{{ comment.email }}">{{ comment.email }}</a>){% endif %} napisa≈Ç(a):
                <span class="comment-date">Dodano {{ comment.created_pl[:16] }}</span>
            </p>
            <p>{{ comment.content }}</p>
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>Brak komentarzy. BƒÖd≈∫ pierwszy!</p>
{% endif %}


        {% if comments_total_pages and comments_total_pages > 1 %}
          <div class="comments-pagination">
            {% if comments_page > 1 %}
              <a href="?cpage={{ comments_page - 1 }}#comments">‚Üê Poprzednia</a>
            {% endif %}

            <span>Strona {{ comments_page }} z {{ comments_total_pages }}</span>

            {% if comments_page < comments_total_pages %}
              <a href="?cpage={{ comments_page + 1 }}#comments">Nastƒôpna ‚Üí</a>
            {% endif %}
          </div>
        {% endif %}
      </div>

      <div class="add-comment">
            <h3>Dodaj komentarz</h3>
    <form action="/post/{{ post.slug }}/comment#comments" method="post">
        <label for="author">Imiƒô:<span style="color:red">*</span></label>
        <input type="text" name="author" id="author" required maxlength="20" value="{{ prefill_author or '' }}" autocomplete="off">

        <label for="email">E-mail</label>
        <input type="email" name="email" id="email" maxlength="30" value="{{ prefill_email or ''}}" autocomplete="off">

        <label for="content">Komentarz:<span style="color:red">*</span> <span class="chars-container">(pozosta≈Ço <span id="chars-left">200</span> znak√≥w)</span></label>
        <textarea name="content" id="comment-content" rows="6" required maxlength="200" autocomplete="off">{{ prefill_content or '' }}</textarea>

        <div class="g-recaptcha" data-sitekey="{{ recaptcha_site_key }}"></div>

        <label class="terms">
            <input type="checkbox" name="terms_accepted" id="terms_accepted" required>
            Zapozna≈Çem(-am) siƒô z
            <a href="/warunki" target="_blank" rel="noopener">warunkami korzystania z serwisu</a>
            oraz <a href="/polityka-prywatnosci" target="_blank" rel="noopener">politykƒÖ prywatno≈õci</a>
                i akceptujƒô ich postanowienia.<span style="color:red">*</span>
        </label>


        <button type="submit">Wy≈õlij</button>
    </form>

      </div>
    </div>
  {% else %}
    <p class="comments-disabled">
      Komentarze dla tego wpisu zosta≈Çy wy≈ÇƒÖczone.
    </p>
  {% endif %}
{% endblock %}

{% block modals %}
  {% include "partials/share-modal.html" %}
{% endblock %}
</article>